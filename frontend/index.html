<!doctype html>
<html lang="de">
<head>
    <title>GGF</title>
    <link rel="stylesheet" type="text/css" href="style.css"/>
    <meta charset="UTF-8">
</head>
<body>
<center>
    <h1>GGF - Das Sitzplatzbingo</h1>
</center>
<div class="rote_striche">
</div>
<div class="Kasten">
    <form>
        <label for="startort">Startort</label>
        <input id="startort" type="text"/>
        <label for="zielort">Zielort</label>
        <input id="zielort" type="text"/>
        <br>
        <label for="zugnummer">Zugnummer</label>
        <input id="zugnummer" type="text"/>
        <br>
        <label for="datum">Datum</label>
        <input id="datum" type="date"/>
        <label for="time">Ankunftszeit</label>
        <input id="time" type="time"/>
        <br>
        <center>
            <button id="search" class="button">Suchen</button>
        </center>
        <br>
        <label for="waggon">Waggon</label>
        <input id="waggon" type="text"/>
        <br>
        <label for="sitz">Sitz</label>
        <input id="sitz" type="text"/>
        <center>
            <button id="direktcheck" class="button">Direktcheck</button>
        </center>
        <br>
    </form>
</div>
<div id="ice"></div>
<hr class="rote_striche">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js" crossorigin="anonymous"></script>
<script>
    function showTrainInfo(result) {
        let counter = 0, reihen = 12;
        result.utilization.forEach(function (element) {
            let k = parseInt(element.wagonPosition);

            let gesamt = element.capacitySeatsFirst + element.capacitySeatsSecond;
            let reserviert = element.seatReservationsFirst + element.seatReservationsSecond;
            let auslastung = Math.round(((reserviert / gesamt) * 100));

            let hinzu2 = "<div class='wagen' id='wagen" + k + "'> Auslastung: " + auslastung + "%</div>";
            document.getElementById("ice").innerHTML += hinzu2;
            for (let j = 1; j <= reihen; j++) {
                let hinzu1 = "<div id='" + k + "reihe" + j + "'></div>";
                document.getElementById("wagen" + k).innerHTML += hinzu1;
                for (let i = 0; i <= 4; i++) {
                    let hinzu = '';
                    if (i === 2) {
                        hinzu = "<div class='zwischenraum'></div>";
                    } else {
                        counter += 1;
                        if (Math.random() * 100 < auslastung) {
                            hinzu = "<div id='sitz" + counter + "' class='sitz' style='background: #333333'>" + ((counter - 1) % (4 * reihen) + 1) + "</div>";
                        } else {
                            hinzu = "<div id='sitz" + counter + "' class='sitz'>" + ((counter - 1) % (4 * reihen) + 1) + "</div>";
                        }

                    }
                    document.getElementById(k + "reihe" + j).innerHTML += hinzu;
                }
            }
        });
    }

    $("button#search").on("click", function (event) {
        event.preventDefault();

        $.ajax({
            url: "https://ggf-backend.margau.me/seats/ICE610/d2019-11-03/Ulm%20Hbf",
            type: "GET",
            crossDomain: true,
            success: function (result) {
                showTrainInfo(result);
            },
            error: function (result) {
                alert('Fehler: ' + JSON.parse(result.responseText).error);
            }
        });
    });
</script>
</body>
</html>
	
